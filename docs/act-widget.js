var PendoAct=(()=>{var L=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Y=Object.prototype.hasOwnProperty;var Z=(t,e)=>{for(var n in e)L(t,n,{get:e[n],enumerable:!0})},tt=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let c of X(e))!Y.call(t,c)&&c!==n&&L(t,c,{get:()=>e[c],enumerable:!(r=Q(e,c))||r.enumerable});return t};var et=t=>tt(L({},"__esModule",{value:!0}),t);var Lt={};Z(Lt,{boot:()=>Et,plans:()=>At,version:()=>St});async function w(t,{timeoutMs:e=8e3}={}){let n=Date.now()+e,r;for(;Date.now()<n;){try{let c=t?.within?await w(t.within,{timeoutMs:1e3}):document,s=nt(c,t);if(s)return s}catch(c){r=c}await lt(150)}throw r||new Error(`Target not found: ${JSON.stringify(t)}`)}function nt(t,e={}){let n=[];return e.testId&&n.push(...t.querySelectorAll(`[data-testid="${C(e.testId)}"]`)),e.selector&&n.push(...t.querySelectorAll(e.selector)),e.placeholder&&n.push(...Array.from(t.querySelectorAll("input,textarea")).filter(c=>c.placeholder?.trim()===e.placeholder)),(e.role||e.name)&&n.push(...rt(t,e.role,e.name)),e.text&&n.push(...ot(t,e.text)),at(n,e)||null}function rt(t,e,n){let r=e?Array.from(t.querySelectorAll(`[role="${C(e)}"]`)):Array.from(t.querySelectorAll("button,a,input,textarea,select,[role]"));if(n){let c=g(n);r=r.filter(s=>g(I(s)).includes(c))}return r}function ot(t,e){let n=g(e),r=t.querySelectorAll('button,a,[role="button"],[role="menuitem"],[role="option"],label,div,span');return Array.from(r).filter(c=>g(c.innerText).includes(n))}function at(t,e){if(!t.length)return null;let n=t.map(r=>({el:r,score:ct(r,e)}));return n.sort((r,c)=>c.score-r.score),n[0].el}function ct(t,e){let n=0;return e.testId&&t.matches(`[data-testid="${C(e.testId)}"]`)&&(n+=10),e.selector&&t.matches(e.selector)&&(n+=5),e.role&&t.getAttribute("role")===e.role&&(n+=3),e.name&&g(I(t)).includes(g(e.name))&&(n+=3),e.text&&g(t.innerText).includes(g(e.text))&&(n+=2),e.placeholder&&t.placeholder?.trim()===e.placeholder&&(n+=1),it(t)&&(n+=2),st(t)&&(n+=1),n}function I(t){return t.getAttribute("aria-label")||t.getAttribute("aria-labelledby")||t.getAttribute("title")||t.innerText||""}function it(t){let e=getComputedStyle(t);return e&&e.visibility!=="hidden"&&e.display!=="none"&&t.offsetParent!==null}function st(t){let e=t.getBoundingClientRect();return e.bottom>0&&e.top<window.innerHeight&&e.right>0&&e.left<window.innerWidth}function g(t){return(t||"").trim().toLowerCase()}function C(t){return String(t).replace(/"/g,'\\"')}function lt(t){return new Promise(e=>setTimeout(e,t))}function P(t,e){try{let r=new URL(t).toString();return e.some(c=>c.test(r))}catch{return!1}}function B(t){let e=t.tagName.toLowerCase(),n=(t.getAttribute("aria-label")||t.innerText||"").toLowerCase(),r=["delete","remove","submit","pay","confirm","approve","purchase","transfer","save"];return e==="button"||t.getAttribute("role")==="button"?r.some(c=>n.includes(c)):!1}async function S(t,e){let{allowlist:n=[/.*/],onEvent:r=()=>{},confirm:c=ht,signal:s}=e||{},i={allowlist:n,onEvent:r,confirm:c,aborted:!1},h=()=>{i.aborted=!0};if(s){if(s.aborted)throw new Error("aborted");s.addEventListener("abort",h,{once:!0})}r({type:"plan:start",task:t.task,steps:t.steps?.length||0});try{for(let f=0;f<(t.steps?.length||0);f++){if(i.aborted)throw new Error("aborted");let x=t.steps[f];r({type:"step:start",i:f,step:x});try{await ut(x,i),r({type:"step:success",i:f})}catch(k){throw r({type:"step:fail",i:f,error:String(k)}),k}}r({type:"plan:success"})}finally{s&&s.removeEventListener("abort",h)}}async function ut(t,e){switch(t.action){case"navigate":return dt(t.url,e);case"waitFor":return M(t,e);case"click":return ft(t,e);case"type":return pt(t,e);case"select":return mt(t,e);case"scroll":return bt(t,e);case"extract":return yt(t,e);default:throw new Error(`Unknown action: ${t.action}`)}}async function dt(t,e){let n=new URL(t,location.href).toString();if(!P(n,e.allowlist))throw new Error(`Blocked by allowlist: ${n}`);location.assign(n),await M({action:"waitFor",urlIncludes:new URL(n).pathname},e)}async function M(t,e){let n=t.timeoutMs??15e3,r=Date.now();for(;Date.now()-r<n;){if(e.aborted)throw new Error("aborted");let c=t.urlIncludes?location.href.includes(t.urlIncludes):!0,s=t.text?document.body.innerText.includes(t.text):!0,i=t.selector?document.querySelector(t.selector):!0;if(c&&s&&i)return;await vt(200)}throw new Error("waitFor timeout")}async function ft(t,e){let n=await w(t.target,{timeoutMs:t.timeoutMs??1e4});if(B(n)&&!await e.confirm({message:`Confirm clicking: ${wt(n)}`}))throw new Error("user_cancelled");n.click()}async function pt(t,e){let n=await w(t.target,{timeoutMs:t.timeoutMs??1e4});if(!(n instanceof HTMLInputElement||n instanceof HTMLTextAreaElement||n.isContentEditable))throw new Error("target_not_typable");(t.clear||n instanceof HTMLInputElement||n instanceof HTMLTextAreaElement)&&(n.value=""),n.isContentEditable?n.textContent=t.value??"":(n.value=t.value??"",n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0})))}async function mt(t,e){let n=await w(t.target,{timeoutMs:t.timeoutMs??1e4});if(n.tagName.toLowerCase()==="select"){let r=n,c=t.value,s=t.label,i=c;if(s!=null){let h=Array.from(r.options).find(f=>f.text.trim()===s);if(!h)throw new Error("option_not_found");i=h.value}if(i==null)throw new Error("select_requires_value_or_label");r.value=i,r.dispatchEvent(new Event("input",{bubbles:!0})),r.dispatchEvent(new Event("change",{bubbles:!0}))}else n.click(),await M({action:"waitFor",text:t.label??t.value,timeoutMs:5e3},e),(await w({text:t.label??t.value},{timeoutMs:3e3})).click()}async function bt(t,e){t.target?(await w(t.target,{timeoutMs:t.timeoutMs??1e4})).scrollIntoView({behavior:"smooth",block:"center"}):typeof t.y=="number"&&window.scrollTo({top:t.y,behavior:t.behavior||"smooth"})}async function yt(t,e){let n=await w(t.target,{timeoutMs:t.timeoutMs??1e4});return t.as==="text"?n.innerText.trim():t.as==="list"?Array.from(n.querySelectorAll('li, [role="listitem"]')).map(r=>r.innerText.trim()):t.as==="table"?gt(n):n.innerText.trim()}function gt(t){return Array.from(t.querySelectorAll("tr")).map(n=>Array.from(n.querySelectorAll("th,td")).map(r=>r.innerText.trim()))}function wt(t){return(t.getAttribute("aria-label")||t.innerText||t.getAttribute("name")||t.id||t.tagName).trim().slice(0,80)}function ht({message:t}){return Promise.resolve(window.confirm(t))}function vt(t){return new Promise(e=>setTimeout(e,t))}var b={task:"Take a day off next Monday",steps:[{action:"waitFor",urlIncludes:"/",timeoutMs:2e4},{action:"click",target:{role:"button",name:"Menu"}},{action:"click",target:{text:"Absence"}},{action:"waitFor",text:"Request Absence",timeoutMs:15e3},{action:"click",target:{role:"button",name:"Request Absence"}},{action:"waitFor",text:"Select date range",timeoutMs:15e3},{action:"click",target:{role:"button",name:"Select date range"}},{action:"click",target:{role:"button",name:"From"}},{action:"click",target:{text:H()}},{action:"click",target:{role:"button",name:"To"}},{action:"click",target:{text:H()}},{action:"waitFor",text:"Type",timeoutMs:1e4},{action:"click",target:{role:"combobox",name:"Type"}},{action:"click",target:{text:"Flexible Time Off"}},{action:"waitFor",text:"Next",timeoutMs:1e4},{action:"click",target:{role:"button",name:"Next"}}]};function H(){let n=(1-new Date().getDay()+7)%7||7,r=new Date(Date.now()+n*24*60*60*1e3);return String(r.getDate())}async function O(t,e={}){let n=(t||"").toLowerCase();if(/(day\s*off|absence|vacation).*(next\s*monday)/.test(n))return b;let r=q();return r&&/(run|execute).*(record(ed)?\s*plan|recording)/.test(n)?r:null}function q(){try{let t=localStorage.getItem("pact.recorder.plan");if(!t)return null;let e=JSON.parse(t);if(e&&Array.isArray(e.steps))return e}catch{}return null}function U({runPlan:t=S,plans:e={samplePlan:b},allowlist:n=[/.*/]}={}){let r={open:!1,running:!1,controller:null},c=document.createElement("div");c.className="pact-root",c.setAttribute("data-pact","root");let s=document.createElement("button");s.className="pact-launcher",s.type="button",s.textContent="Act",c.appendChild(s);let i=document.createElement("div");i.className="pact-panel pact-hidden",i.innerHTML=`
    <div class="pact-header">
      <div class="pact-title">Pendo Act (POC)</div>
      <div class="pact-tools">
        <button class="pact-record" type="button" aria-pressed="false">\u25CF Record</button>
        <button class="pact-save" type="button">Save</button>
        <button class="pact-run-recording" type="button">Run Recording</button>
        <button class="pact-clear-recording" type="button">Clear</button>
        <button class="pact-close" type="button" aria-label="Close">\xD7</button>
      </div>
    </div>
    <div class="pact-body">
      <div class="pact-quick">
        <button class="pact-quick-btn" data-action="workday-dayoff">Take a day off next Monday</button>
      </div>
      <div class="pact-chat">
        <form class="pact-form">
          <input class="pact-input" name="q" placeholder="Describe what to do\u2026" autocomplete="off" />
          <button class="pact-run" type="submit">Run</button>
          <button class="pact-stop" type="button">Stop</button>
        </form>
      </div>
      <div class="pact-log" aria-live="polite"></div>
    </div>
  `,c.appendChild(i),document.body.appendChild(c);let h=i.querySelector(".pact-close"),f=i.querySelector(".pact-log"),x=i.querySelector(".pact-form"),k=i.querySelector(".pact-input"),R=i.querySelector(".pact-run"),A=i.querySelector(".pact-stop"),v=i.querySelector(".pact-record"),_=i.querySelector(".pact-save"),W=i.querySelector(".pact-run-recording"),J=i.querySelector(".pact-clear-recording");function N(){r.open=!0,i.classList.remove("pact-hidden")}function T(){r.open=!1,i.classList.add("pact-hidden")}function $(){r.open?T():N()}s.addEventListener("click",$),h.addEventListener("click",T),i.querySelector(".pact-quick-btn").addEventListener("click",async()=>{await E(b)}),x.addEventListener("submit",async o=>{o.preventDefault();let l=k.value.trim();if(!l)return;let a=await O(l,{plans:{samplePlan:b}});a?await E(a):d("Planner",'No matching plan. Try: "Take a day off next Monday" or "Run recorded plan"')}),A.addEventListener("click",()=>{r.controller&&r.controller.abort()});let p={enabled:!1,steps:[],handlers:[]};v.addEventListener("click",()=>{p.enabled?j():V()}),_.addEventListener("click",()=>z()),W.addEventListener("click",async()=>{let o=q();if(!o)return d("Recorder","No recording found in localStorage");await E(o)}),J.addEventListener("click",()=>{localStorage.removeItem("pact.recorder.plan"),d("Recorder","Cleared saved recording")});function V(){p.enabled=!0,v.setAttribute("aria-pressed","true"),v.classList.add("pact-recording"),d("Recorder","Recording started");let o=a=>{if(!p.enabled)return;let u=a.target;if(u.closest(".pact-root"))return;let y=D(u);p.steps.push({action:"click",target:y}),F(u)},l=a=>{if(!p.enabled)return;let u=a.target;if(u.closest(".pact-root")||!(u instanceof HTMLInputElement||u instanceof HTMLTextAreaElement||u.isContentEditable))return;let y=D(u),m=u.isContentEditable?u.textContent||"":u.value||"";p.steps.push({action:"type",target:y,value:m}),F(u)};document.addEventListener("click",o,!0),document.addEventListener("change",l,!0),p.handlers=[["click",o],["change",l]]}function j(){p.enabled=!1,v.setAttribute("aria-pressed","false"),v.classList.remove("pact-recording");for(let[o,l]of p.handlers)document.removeEventListener(o,l,!0);p.handlers=[],d("Recorder",`Recording stopped. Steps: ${p.steps.length}. Click Save to persist.`)}function z(){let o={task:"Recorded Task",steps:p.steps.slice()};localStorage.setItem("pact.recorder.plan",JSON.stringify(o)),d("Recorder","Saved to localStorage under key: pact.recorder.plan")}function D(o){return{selector:G(o),role:o.getAttribute("role")||void 0,name:o.getAttribute("aria-label")||void 0,text:(o.innerText||"").trim().slice(0,60)||void 0,placeholder:o.placeholder||void 0}}function F(o){o.classList.add("pact-recorder-highlight"),setTimeout(()=>o.classList.remove("pact-recorder-highlight"),300)}function G(o){if(!o||o.nodeType!==1)return null;if(o.id)return`#${o.id}`;if(o.getAttribute("data-testid"))return`[data-testid="${o.getAttribute("data-testid")}"]`;let l=[];for(;o&&o.nodeType===1&&l.length<4&&!o.id&&!o.getAttribute("data-testid");){let a=o.nodeName.toLowerCase();if(o.className){let m=String(o.className).trim().split(/\s+/).slice(0,2).join(".");m&&(a+=`.${m}`)}let u=o.parentNode;if(!u)break;let y=Array.from(u.children).filter(m=>m.nodeName===o.nodeName);y.length>1&&(a+=`:nth-of-type(${1+y.indexOf(o)})`),l.unshift(a),o=u,o.id&&l.unshift(`#${o.id}`)}return l.join(" > ")}function d(o,l){let a=document.createElement("div");a.className="pact-log-item",a.textContent=`[${o}] ${l}`,f.appendChild(a),f.scrollTop=f.scrollHeight}async function K({message:o}){return await new Promise(l=>{let a=document.createElement("div");a.className="pact-confirm",a.innerHTML=`
        <div class="pact-confirm-box" role="dialog" aria-modal="true">
          <div class="pact-confirm-msg"></div>
          <div class="pact-confirm-actions">
            <button class="pact-btn-yes" type="button">Confirm</button>
            <button class="pact-btn-no" type="button">Cancel</button>
          </div>
        </div>
      `,a.querySelector(".pact-confirm-msg").textContent=o;let u=a.querySelector(".pact-btn-yes"),y=a.querySelector(".pact-btn-no");u.addEventListener("click",()=>{m(),l(!0)}),y.addEventListener("click",()=>{m(),l(!1)}),document.body.appendChild(a);function m(){a.remove()}})}async function E(o){if(r.running)return;r.running=!0,R.disabled=!0,A.disabled=!1,r.controller=new AbortController;let l=Date.now();d("Agent",`Starting task: ${o.task}`);try{await t(o,{allowlist:n,confirm:K,signal:r.controller.signal,onEvent:a=>{a.type==="step:start"&&d("Step",`#${a.i+1} ${a.step.action}`),a.type==="step:success"&&d("Step",`#${a.i+1} \u2713`),a.type==="step:fail"&&d("Error",`#${a.i+1} ${a.error}`),a.type==="plan:success"&&d("Agent",`Done in ${Math.round((Date.now()-l)/1e3)}s`)}})}catch(a){String(a)==="Error: aborted"||String(a)==="aborted"?d("Agent","Stopped by user"):d("Agent",`Failed: ${String(a)}`)}finally{r.running=!1,R.disabled=!1,A.disabled=!0,r.controller=null}}return setTimeout(()=>{},0),{open:N,close:T,toggle:$,runTask:E,appendLog:d}}function xt(){let t=document.currentScript||Array.from(document.getElementsByTagName("script")).find(e=>e.src&&e.src.includes("act-widget"));try{return t?new URL(".",t.src).toString():""}catch{return""}}function kt(t){if(!t||Array.from(document.styleSheets).find(r=>r.href===t))return;let n=document.createElement("link");n.rel="stylesheet",n.href=t,document.head.appendChild(n)}function Et(t={}){let e=t.baseUrl||xt();kt(`${e}act-widget.css`);let n=t.allowlist||[new RegExp("^"+Tt(location.origin))],r={workdayTakeDayOffNextMonday:b,...t.plans||{}};return U({runPlan:S,plans:r,allowlist:n})}var St="0.1.0",At={workdayTakeDayOffNextMonday:b};function Tt(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}return et(Lt);})();
//# sourceMappingURL=act-widget.js.map
